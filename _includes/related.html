{% assign current_post = include.post %}

<aside class="related" role="complementary">
  <h2><i>Related stuff</i></h2>

  <ul class="related-posts">
    {% assign plusone = false %}
    {% assign tag_name = post.tags[0] %}
    {% for post in site.tags[tag_name] limit:4 %}
      {% if post.slug == current_post.slug %}
        {% assign plusone = true %}
        {% continue %}
      {% endif %}
      {% if forloop.index < 4 or plusone == true %}
        {% include post-list-item.html post=post format="%m/%d/%y" %}
      {% endif %}
      <br>
    {% endfor %}
    
    {% for post in site.drafts %}
        {% for tag in post.tags %}
            {% if tag == tag_name %}
                {% include post-list-item.html post=post format="%m/%d/%y" %}
            {% endif %}
        {% endfor %}
        <br>
    {% endfor %}
    
    {% for page in site.pages %}
        {% for tag in page.tags %}
            {% if tag == tag_name %}
                {% include post-list-item.html post=page format="%m/%d/%y" %}
            {% endif %}
        {% endfor %}
        <br>
    {% endfor %}
  </ul>
</aside>
